<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Stock Watchlist</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCd2vJNlGVh9q1GWT2M_GepSKolo-t2Sr4",
    authDomain: "stock-watchlist-app-1eced.firebaseapp.com",
    projectId: "stock-watchlist-app-1eced",
    storageBucket: "stock-watchlist-app-1eced.firebasestorage.app",
    messagingSenderId: "99623824439",
    appId: "1:99623824439:web:21b9546b0ceee31ba623b2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  window.firebaseApp = { auth, db, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, doc, setDoc, getDoc };
</script>

<style>
body { font-family: Inter, Arial; background:#f4f6fb; padding:30px; }
.container { max-width:1000px; margin:auto; }
.hidden{display:none;}
.card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.08);}
button{padding:10px 16px;border:none;border-radius:6px;background:#2563eb;color:#fff;cursor:pointer}
input{padding:10px;width:100%;margin:6px 0}
</style>
</head>

<body>

<div id="authBox" class="card">
  <h2>Login / Sign Up</h2>
  <input id="email" placeholder="Email" />
  <input id="password" type="password" placeholder="Password" />
  <button onclick="login()">Login</button>
  <button onclick="signup()">Sign Up</button>
</div>

<div id="app" class="hidden">
  <div class="container">
    <h1>ðŸ“ˆ Stock Watchlist</h1>
    <button onclick="logout()">Logout</button>
    <div id="watchlistBox" class="card"></div>
  </div>
</div>

<script>
emailjs.init("-nPbEj5p827UiuqEA");

let userId=null;
let watchlist=[];

const fb = window.firebaseApp;

function signup(){
  fb.createUserWithEmailAndPassword(fb.auth,email.value,password.value)
}
function login(){
  fb.signInWithEmailAndPassword(fb.auth,email.value,password.value)
}
function logout(){ fb.signOut(fb.auth); }

fb.onAuthStateChanged(fb.auth, async user=>{
  if(user){
    userId=user.uid;
    authBox.classList.add("hidden");
    app.classList.remove("hidden");
    const ref=fb.doc(fb.db,"watchlists",userId);
    const snap=await fb.getDoc(ref);
    watchlist=snap.exists()?snap.data().stocks:[];
    render();
  } else {
    app.classList.add("hidden");
    authBox.classList.remove("hidden");
  }
});

async function save(){
  await fb.setDoc(fb.doc(fb.db,"watchlists",userId),{stocks:watchlist});
}

function add(sym){
  if(!watchlist.includes(sym)){
    watchlist.push(sym); save(); render();
  }
}

function render(){
  watchlistBox.innerHTML = watchlist.map(s=>`
    <div>${s} <button onclick="remove('${s}')">x</button></div>
  `).join("");
}

function remove(sym){
  watchlist=watchlist.filter(s=>s!==sym);
  save(); render();
}
</script>
</body>
</html>
