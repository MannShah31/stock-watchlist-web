<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Stock Watchlist</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCd2vJNlGVh9q1GWT2M_GepSKolo-t2Sr4",
  authDomain: "stock-watchlist-app-1eced.firebaseapp.com",
  projectId: "stock-watchlist-app-1eced",
  storageBucket: "stock-watchlist-app-1eced.firebasestorage.app",
  messagingSenderId: "99623824439",
  appId: "1:99623824439:web:21b9546b0ceee31ba623b2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

emailjs.init("-nPbEj5p827UiuqEA");

let userId = null;
let watchlist = [];

window.signup = async function () {
  try {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;

    if (!email || !pass) {
      alert("Enter email and password");
      return;
    }

    await createUserWithEmailAndPassword(auth, email, pass);
    alert("Account created successfully!");
  } catch (err) {
    alert("Signup failed: " + err.message);
  }
};

window.login = async function () {
  try {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;

    if (!email || !pass) {
      alert("Enter email and password");
      return;
    }

    await signInWithEmailAndPassword(auth, email, pass);
  } catch (err) {
    alert("Login failed: " + err.message);
  }
};

window.logout = async function () {
  await signOut(auth);
};

onAuthStateChanged(auth, async user => {
  if (user) {
    userId = user.uid;
    document.getElementById("authBox").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");

    const ref = doc(db, "watchlists", userId);
    const snap = await getDoc(ref);
    watchlist = snap.exists() ? snap.data().stocks : [];
    render();
  } else {
    document.getElementById("authBox").classList.remove("hidden");
    document.getElementById("app").classList.add("hidden");
  }
});

async function save() {
  await setDoc(doc(db, "watchlists", userId), { stocks: watchlist });
}

function add(sym) {
  if (!watchlist.includes(sym)) {
    watchlist.push(sym);
    save();
    render();
  }
}

function remove(sym) {
  watchlist = watchlist.filter(s => s !== sym);
  save();
  render();
}

function render() {
  const box = document.getElementById("watchlistBox");
  box.innerHTML = watchlist
    .map(
      s => `<div>${s} <button onclick="remove('${s}')">âœ•</button></div>`
    )
    .join("");
}

window.remove = remove;
window.add = add;
</script>

<style>
body { font-family: Inter, Arial; background:#f4f6fb; padding:40px }
.hidden { display:none }
.card {
  background:#fff; padding:20px; border-radius:12px;
  max-width:400px; margin:auto; box-shadow:0 10px 25px rgba(0,0,0,.1)
}
button { background:#2563eb;color:white;padding:10px;border:none;border-radius:6px;margin-right:6px }
input { padding:10px;width:100%;margin-bottom:10px }
</style>
</head>

<body>

<div id="authBox" class="card">
  <h2>Login / Sign Up</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password (min 6 chars)">
  <button onclick="login()">Login</button>
  <button onclick="signup()">Sign Up</button>
</div>

<div id="app" class="hidden">
  <div class="card">
    <h2>Your Watchlist</h2>
    <button onclick="add('RELIANCE.NS')">Add RELIANCE</button>
    <button onclick="add('TCS.NS')">Add TCS</button>
    <div id="watchlistBox"></div>
    <button onclick="logout()">Logout</button>
  </div>
</div>

</body>
</html>
